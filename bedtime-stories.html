<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ™ Magical Bedtime Stories</title>
    <link rel="stylesheet" href="bedtime-stories.css">`n    <link rel="stylesheet" href="main-menu.css">
    <script src="universal-back-button.js"></script>`n</head>
<body>
    <div class="story-universe">
        <!-- Animated Background -->
        <div class="stars"></div>
        <div class="twinkling"></div>
        <div class="clouds"></div>
        
        <div class="story-container">
            <!-- Magical Header -->
            <header class="story-header">
                <div class="header-magic">
                    <div class="magic-wand">ğŸª„</div>
                    <h1 class="title-animated">ğŸŒ™ Magical Story Creator ğŸŒŸ</h1>
                    <div class="subtitle-container">
                        <p class="subtitle-animated">Where dreams come to life and adventures begin...</p>
                        <div class="floating-elements">
                            <span class="float-emoji">âœ¨</span>
                            <span class="float-emoji">ğŸ¦‹</span>
                            <span class="float-emoji">ğŸŒŸ</span>
                            <span class="float-emoji">ğŸ¦„</span>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Interactive Story Builder -->
            <div class="story-builder" id="storyBuilder">
                <div class="builder-steps">
                    <div class="step-indicator">
                        <div class="step active" data-step="1">
                            <div class="step-icon">ğŸ‘«</div>
                            <span>Characters</span>
                        </div>
                        <div class="step" data-step="2">
                            <div class="step-icon">ğŸ­</div>
                            <span>Theme</span>
                        </div>
                        <div class="step" data-step="3">
                            <div class="step-icon">âš™ï¸</div>
                            <span>Settings</span>
                        </div>
                        <div class="step" data-step="4">
                            <div class="step-icon">âœ¨</div>
                            <span>Magic!</span>
                        </div>
                    </div>

                    <!-- Step 1: Character Selection -->
                    <div class="step-content active" data-step="1">
                        <div class="step-header">
                            <h2>ğŸ‘« Who's in Your Story?</h2>
                            <p>Choose your heroes and friends for this magical adventure!</p>
                        </div>
                        
                        <div class="character-builder">
                            <div class="quick-characters">
                                <h3>ğŸ­ Quick Character Ideas</h3>
                                <div class="character-chips">
                                    <div class="character-chip" data-character="Luna the brave princess">ğŸ‘¸ Luna the brave princess</div>
                                    <div class="character-chip" data-character="Max the friendly dragon">ğŸ‰ Max the friendly dragon</div>
                                    <div class="character-chip" data-character="Sparkle the unicorn">ğŸ¦„ Sparkle the unicorn</div>
                                    <div class="character-chip" data-character="Willow the wise owl">ğŸ¦‰ Willow the wise owl</div>
                                    <div class="character-chip" data-character="Ruby the magical cat">ğŸ± Ruby the magical cat</div>
                                    <div class="character-chip" data-character="Oliver the kind robot">ğŸ¤– Oliver the kind robot</div>
                                </div>
                            </div>
                            
                            <div class="custom-character">
                                <h3>âœï¸ Create Your Own Characters</h3>
                                <div class="character-input-container">
                                    <input type="text" id="characters" placeholder="Type your characters here or click ideas above...">
                                    <div class="character-counter">
                                        <span id="characterCount">0</span> characters added
                                    </div>
                                </div>
                                <div class="character-tips">
                                    ğŸ’¡ <strong>Tips:</strong> Try "Bella the singing mermaid" or "Storm the space explorer"
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Theme Selection -->
                    <div class="step-content" data-step="2">
                        <div class="step-header">
                            <h2>ğŸ­ What Kind of Adventure?</h2>
                            <p>Choose the magical world for your story!</p>
                        </div>
                        
                        <div class="theme-selector">
                            <div class="theme-grid">
                                <div class="theme-card" data-theme="adventure">
                                    <div class="theme-icon">ğŸ—ºï¸</div>
                                    <h3>Epic Adventure</h3>
                                    <p>Brave quests, hidden treasures, and heroic journeys</p>
                                    <div class="theme-preview">ğŸ° âš”ï¸ ğŸ—ï¸ ğŸ‰</div>
                                </div>
                                
                                <div class="theme-card" data-theme="friendship">
                                    <div class="theme-icon">ğŸ’–</div>
                                    <h3>Friendship Magic</h3>
                                    <p>Heartwarming tales of kindness and friendship</p>
                                    <div class="theme-preview">ğŸŒˆ ğŸ¤— ğŸŒ¸ ğŸ’«</div>
                                </div>
                                
                                <div class="theme-card" data-theme="magic">
                                    <div class="theme-icon">âœ¨</div>
                                    <h3>Enchanted World</h3>
                                    <p>Spells, wizards, and magical creatures</p>
                                    <div class="theme-preview">ğŸª„ ğŸ¦„ ğŸŒŸ ğŸ”®</div>
                                </div>
                                
                                <div class="theme-card" data-theme="space">
                                    <div class="theme-icon">ğŸš€</div>
                                    <h3>Space Adventure</h3>
                                    <p>Explore galaxies and meet alien friends</p>
                                    <div class="theme-preview">ğŸŒŒ ğŸ‘½ ğŸ›¸ â­</div>
                                </div>
                                
                                <div class="theme-card" data-theme="ocean">
                                    <div class="theme-icon">ğŸŒŠ</div>
                                    <h3>Ocean Mystery</h3>
                                    <p>Underwater kingdoms and sea creature friends</p>
                                    <div class="theme-preview">ğŸ§œâ€â™€ï¸ ğŸ™ ğŸ  ğŸ’</div>
                                </div>
                                
                                <div class="theme-card" data-theme="dreams">
                                    <div class="theme-icon">ğŸ’­</div>
                                    <h3>Dreamland</h3>
                                    <p>Peaceful adventures in the land of dreams</p>
                                    <div class="theme-preview">â˜ï¸ ğŸŒ™ ğŸ’¤ ğŸŒˆ</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Story Settings -->
                    <div class="step-content" data-step="3">
                        <div class="step-header">
                            <h2>âš™ï¸ Perfect Your Story</h2>
                            <p>Make it just right for bedtime!</p>
                        </div>
                        
                        <div class="settings-grid">
                            <div class="setting-card">
                                <h3>ğŸ“– Story Length</h3>
                                <div class="length-options">
                                    <div class="length-option" data-length="short">
                                        <div class="length-icon">âš¡</div>
                                        <div class="length-info">
                                            <strong>Quick Tale</strong>
                                            <span>2-3 minutes</span>
                                        </div>
                                    </div>
                                    <div class="length-option active" data-length="medium">
                                        <div class="length-icon">ğŸ“š</div>
                                        <div class="length-info">
                                            <strong>Perfect Story</strong>
                                            <span>5-7 minutes</span>
                                        </div>
                                    </div>
                                    <div class="length-option" data-length="long">
                                        <div class="length-icon">ğŸ““</div>
                                        <div class="length-info">
                                            <strong>Epic Adventure</strong>
                                            <span>10-12 minutes</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="setting-card">
                                <h3>ğŸ­ Story Mood</h3>
                                <div class="mood-options">
                                    <div class="mood-option active" data-mood="peaceful">
                                        <span class="mood-emoji">ğŸ˜Œ</span>
                                        <span>Peaceful & Calming</span>
                                    </div>
                                    <div class="mood-option" data-mood="exciting">
                                        <span class="mood-emoji">ğŸ‰</span>
                                        <span>Fun & Exciting</span>
                                    </div>
                                    <div class="mood-option" data-mood="heartwarming">
                                        <span class="mood-emoji">â¤ï¸</span>
                                        <span>Heartwarming</span>
                                    </div>
                                    <div class="mood-option" data-mood="mysterious">
                                        <span class="mood-emoji">ğŸ”</span>
                                        <span>Mysterious</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="custom-setting">
                            <h3>ğŸ° Special Setting (Optional)</h3>
                            <input type="text" id="setting" placeholder="magical castle, enchanted forest, cloud kingdom...">
                            <div class="setting-hint">ğŸ’¡ Leave blank for automatic magic!</div>
                        </div>
                    </div>

                    <!-- Step 4: Magic Creation -->
                    <div class="step-content" data-step="4">
                        <div class="step-header">
                            <h2>âœ¨ Ready for Magic?</h2>
                            <p>Your story is ready to come to life!</p>
                        </div>
                        
                        <div class="magic-buttons">
                            <button class="btn-magic-create" onclick="generateStory()">
                                <div class="btn-content">
                                    <span class="btn-icon">âœ¨</span>
                                    <span class="btn-text">Create My Story</span>
                                    <span class="btn-sparkles">ğŸŒŸ</span>
                                </div>
                            </button>
                            
                            <button class="btn-magic-surprise" onclick="generateSurpriseStory()">
                                <div class="btn-content">
                                    <span class="btn-icon">ğŸ²</span>
                                    <span class="btn-text">Surprise Me!</span>
                                    <span class="btn-sparkles">ğŸŠ</span>
                                </div>
                            </button>
                        </div>
                        
                        <div class="story-preview" id="storyPreview">
                            <!-- Dynamic preview will appear here -->
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="step-navigation">
                        <button class="btn-nav btn-prev" onclick="previousStep()" style="display: none;">
                            <span>â† Back</span>
                        </button>
                        <button class="btn-nav btn-next" onclick="nextStep()">
                            <span>Next â†’</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Magical Story Display -->
            <div class="story-experience" id="storyOutput" style="display: none;">
                <div class="story-book">
                    <div class="book-cover">
                        <div class="cover-decoration">
                            <div class="cover-stars">âœ¨ â­ ğŸŒŸ âœ¨</div>
                            <h2 class="story-title" id="storyTitle">Your Magical Story</h2>
                            <div class="story-meta-badges">
                                <span class="meta-badge" id="readingTime">ğŸ“– 5 minutes</span>
                                <span class="meta-badge" id="storyTheme">âœ¨ Magic</span>
                            </div>
                            <div class="cover-illustration">ğŸ“š</div>
                        </div>
                    </div>
                    
                    <div class="book-pages">
                        <div class="story-content">
                            <div class="story-text" id="storyText">
                                <!-- Generated story will appear here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Audio Controls -->
                <div class="story-player">
                    <div class="player-header">
                        <h3>ğŸ§ Story Player</h3>
                        <div class="player-subtitle">Listen to your magical tale</div>
                    </div>
                    
                    <div class="voice-selection">
                        <div class="voice-grid">
                            <div class="voice-card active" data-voice-type="gentle">
                                <div class="voice-avatar">ğŸ‘©</div>
                                <div class="voice-info">
                                    <strong>Gentle Voice</strong>
                                    <span>Soft & Soothing</span>
                                </div>
                            </div>
                            <div class="voice-card" data-voice-type="warm">
                                <div class="voice-avatar">ğŸ‘¨</div>
                                <div class="voice-info">
                                    <strong>Warm Voice</strong>
                                    <span>Kind & Caring</span>
                                </div>
                            </div>
                            <div class="voice-card" data-voice-type="magical">
                                <div class="voice-avatar">âœ¨</div>
                                <div class="voice-info">
                                    <strong>Magical Voice</strong>
                                    <span>Enchanting</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="voice-fine-tune">
                            <div class="voice-control">
                                <label>ğŸŒ Speed ğŸ°</label>
                                <input type="range" id="voiceSpeed" min="0.5" max="1.5" step="0.1" value="0.8">
                                <span id="speedValue">0.8x</span>
                            </div>
                            <div class="voice-control">
                                <label>ğŸµ Pitch ğŸ¶</label>
                                <input type="range" id="voicePitch" min="0.8" max="1.5" step="0.1" value="1.1">
                                <span id="pitchValue">1.1</span>
                            </div>
                        </div>
                        
                        <!-- Hidden technical voice selector -->
                        <select id="voiceSelect" style="display: none;">
                            <option value="">Loading voices...</option>
                        </select>
                    </div>
                    
                    <div class="player-controls">
                        <button class="btn-play-main" onclick="readStoryAloud()">
                            <div class="play-icon">ğŸ”Š</div>
                            <span class="play-text">Read My Story</span>
                            <div class="play-animation"></div>
                        </button>
                    </div>
                </div>

                <!-- Story Actions -->
                <div class="story-actions">
                    <button class="action-btn save-btn" onclick="saveStory()">
                        <span class="btn-icon">ğŸ’¾</span>
                        <span>Save Story</span>
                    </button>
                    <button class="action-btn share-btn" onclick="shareStory()">
                        <span class="btn-icon">ğŸ“¤</span>
                        <span>Share</span>
                    </button>
                    <button class="action-btn new-btn" onclick="showStoryForm()">
                        <span class="btn-icon">âœ¨</span>
                        <span>New Story</span>
                    </button>
                </div>
            </div>

            <!-- Magical Library -->
            <div class="story-library">
                <div class="library-header">
                    <h3>ğŸ“š Your Magical Library</h3>
                    <p>All your saved adventures</p>
                </div>
                <div class="saved-stories-grid" id="savedStoriesList">
                    <!-- Saved stories will appear here -->
                </div>
            </div>

            <!-- Navigation -->
            <div class="navigation">
                <a href="index.html" class="btn-back-home">
                    <span class="back-icon">ğŸ </span>
                    <span>Back to Games</span>
                </a>
            </div>
        </div>

        <!-- Enhanced Loading Experience - DISABLED FOR TESTING -->
        <div class="loading-universe" id="loadingOverlay" style="display: none !important; visibility: hidden !important; opacity: 0 !important;">
            <div class="loading-stars"></div>
            <div class="loading-content">
                <div class="magic-cauldron">
                    <div class="cauldron">ğŸª„</div>
                    <div class="magic-bubbles">
                        <div class="bubble">âœ¨</div>
                        <div class="bubble">ğŸŒŸ</div>
                        <div class="bubble">ğŸ’«</div>
                        <div class="bubble">â­</div>
                    </div>
                </div>
                <h3 class="loading-title">Creating Your Magical Story...</h3>
                <div class="loading-tips" id="loadingTips">
                    âœ¨ Gathering magical ingredients...
                </div>
                <div class="loading-progress">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                </div>
                
                <!-- Emergency Force Display Button -->
                <button id="forceDisplayBtn" onclick="forceDisplayStory()" style="
                    position: absolute;
                    bottom: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: #ff4444;
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 5px;
                    cursor: pointer;
                    font-size: 14px;
                    z-index: 10000;
                ">ğŸš¨ FORCE DISPLAY STORY</button>
            </div>
        </div>
    </div>

    <script src="bedtime-stories.js"></script>
    
    <!-- TESTING: Force disable loading overlays -->
    <style>
        #loadingOverlay, .loading-universe, .loading-overlay {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            z-index: -9999 !important;
            pointer-events: none !important;
        }
        #storyOutput {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
    </style>
    
    <!-- Debug Script -->
    <script>
        console.log('ğŸš€ Debug script loaded');
        
        // Add debug button after page loads
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                console.log('ğŸ” Checking story generator status...');
                console.log('storyGenerator exists:', !!storyGenerator);
                console.log('window.storyGenerator exists:', !!window.storyGenerator);
                console.log('generateStory function:', typeof generateStory);
                
                // Add a test button
                const testBtn = document.createElement('button');
                testBtn.innerHTML = 'ğŸ§ª TEST STORY GENERATION';
                testBtn.style.cssText = `
                    position: fixed; 
                    top: 10px; 
                    right: 10px; 
                    z-index: 9999; 
                    background: red; 
                    color: white; 
                    padding: 10px; 
                    border: none; 
                    border-radius: 5px;
                    cursor: pointer;
                `;
                testBtn.onclick = () => {
                    console.log('ğŸ§ª Test button clicked');
                    
                    // Test immediate story creation and display
                    const testStory = {
                        title: "ğŸŒŸ Luna the brave princess's Great Adventure",
                        content: `Once upon a time, in a land far beyond the rainbow, there lived Luna the brave princess and Sparkle the magical unicorn.

They made their home in an enchanted forest, where magic sparkled in every corner and every day brought new wonders.

Luna was known for being brave and kind, and together with Sparkle, they spent their days exploring and helping all the creatures of the forest.

One beautiful morning, Luna discovered a mysterious map that led to an ancient treasure. A sense of wonder filled their heart as they realized this was the beginning of something truly special.

They climbed the highest mountain and discovered a view more beautiful than any picture. Along the way, they helped a family of lost rabbits find their way home and shared their lunch with a hungry squirrel.

In the end, Luna and her friends learned that the greatest treasure was the friendship they made along the way.

As the stars began to twinkle in the evening sky, Luna felt grateful for the wonderful adventure and the precious friends who shared it. With hearts full of joy and minds full of beautiful memories, they settled down for a peaceful night's sleep, knowing that tomorrow would bring new possibilities for kindness, friendship, and magical moments.`,
                        readingTime: "5-7 minutes",
                        theme: "adventure",
                        characters: ["Luna the brave princess", "Sparkle the magical unicorn"]
                    };
                    
                    // Force display the story immediately
                    const storyBuilder = document.getElementById('storyBuilder');
                    const storyOutput = document.getElementById('storyOutput');
                    const titleElement = document.getElementById('storyTitle');
                    const textElement = document.getElementById('storyText');
                    const readingTimeElement = document.getElementById('readingTime');
                    
                    if (storyBuilder) storyBuilder.style.display = 'none';
                    
                    if (titleElement) titleElement.textContent = testStory.title;
                    if (readingTimeElement) readingTimeElement.textContent = `ğŸ“– ${testStory.readingTime}`;
                    if (textElement) {
                        const formattedContent = testStory.content.split('\n\n').map(paragraph => 
                            `<p class="story-paragraph">${paragraph}</p>`
                        ).join('');
                        textElement.innerHTML = formattedContent;
                    }
                    
                    if (storyOutput) {
                        storyOutput.style.display = 'block';
                        storyOutput.style.visibility = 'visible';
                        storyOutput.style.opacity = '1';
                        storyOutput.scrollIntoView({ behavior: 'smooth' });
                    }
                    
                    // Hide all loading overlays
                    const loadingElements = document.querySelectorAll('#loadingOverlay, .loading-universe, .loading-overlay');
                    loadingElements.forEach(el => {
                        el.style.display = 'none';
                        el.style.visibility = 'hidden';
                        el.style.opacity = '0';
                    });
                    
                    console.log('âœ… Test story displayed successfully!');
                };
                document.body.appendChild(testBtn);
                
                // Add emergency bypass button
                const bypassBtn = document.createElement('button');
                bypassBtn.innerHTML = 'ğŸš¨ FORCE SHOW STORY';
                bypassBtn.style.cssText = `
                    position: fixed; 
                    top: 60px; 
                    right: 10px; 
                    z-index: 9999; 
                    background: orange; 
                    color: white; 
                    padding: 10px; 
                    border: none; 
                    border-radius: 5px;
                    cursor: pointer;
                `;
                bypassBtn.onclick = () => {
                    console.log('ğŸš¨ Emergency bypass clicked');
                    
                    // Hide loading overlay
                    const loadingOverlay = document.getElementById('loadingOverlay');
                    if (loadingOverlay) {
                        loadingOverlay.style.display = 'none';
                        console.log('Loading hidden');
                    }
                    
                    // Show story output
                    const outputElement = document.getElementById('storyOutput');
                    const builderElement = document.getElementById('storyBuilder');
                    
                    if (builderElement) {
                        builderElement.style.display = 'none';
                        console.log('Builder hidden');
                    }
                    
                    if (outputElement) {
                        outputElement.style.display = 'block';
                        outputElement.scrollIntoView({ behavior: 'smooth' });
                        console.log('Story output forced to show');
                    }
                    
                    // If no story exists, create one
                    if (storyGenerator && !storyGenerator.currentStory) {
                        const story = storyGenerator.createPersonalizedStory(
                            'Luna the brave princess, Sparkle the unicorn', 
                            'adventure', 
                            'medium', 
                            'peaceful', 
                            'magical forest'
                        );
                        if (story) {
                            storyGenerator.displayStory(story);
                            console.log('Emergency story created and displayed');
                        }
                    }
                };
                document.body.appendChild(bypassBtn);
                
                // Override the original generateStory to add logging
                const originalGenerateStory = window.generateStory;
                window.generateStory = function() {
                    console.log('ğŸ¯ generateStory() called');
                    console.log('storyGenerator available:', !!storyGenerator);
                    if (originalGenerateStory) {
                        console.log('ğŸ“ Calling original generateStory...');
                        originalGenerateStory();
                    } else {
                        console.error('âŒ Original generateStory not found');
                    }
                };
                
            }, 1000);
        });
    </script>
    
    <!-- Feedback Widget -->
    <!-- Feedback widget CSS removed -->
    <!-- Feedback widget script removed -->
    
    <!-- Pizza Payment Widget -->
    <link rel="stylesheet" href="pizza-payment.css">`n    <link rel="stylesheet" href="main-menu.css">
    <script src="pizza-payment.js"></script>
    
    <script>
        // Initialize widgets
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof initializeFeedbackWidget === 'function') {
                initializeFeedbackWidget();
            }
        });
    </script>
    <script src="bedtime-stories-interactive.js"></script>
</body>
</html>
